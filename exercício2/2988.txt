select 
name, 
count(name) as matches, 
sum(vitorias) as victories,
sum(derrotas) as defeats, 
sum(empate) as draws, 
(sum(vitorias) * 3) + (sum(empate) * 1) as score
from 
(
select t.name, 
case when m.team_1_goals > m.team_2_goals then 1 else 0 end as vitorias, 
case when m.team_1_goals < m.team_2_goals then 1 else 0 end as derrotas, 
case when m.team_1_goals = m.team_2_goals then 1 else 0 end as empate 
from 
teams t
inner join matches m on m.team_1 = t.id 

union all 

select t.name, 
case when m.team_2_goals > m.team_1_goals then 1 else 0 end as vitorias, 
case when m.team_2_goals < m.team_1_goals then 1 else 0 end as derrotas, 
case when m.team_2_goals = m.team_1_goals then 1 else 0 end as empate 
from 
teams t
inner join matches m on m.team_2 = t.id
) as tabela 
group by 
name
order by
score desc;
