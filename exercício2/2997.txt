select d.nome as departamento, e.nome as empregado,
case when cs.total_vencimentos = 0 then 0
 else cs.total_vencimentos end as "salario bruto",
case when cs.total_descontos = 0 then 0
 else cs.total_descontos end as "total desconto",
case when cs.salario = 0 then 0
 else cs.salario end as "salario liquidoaws"
from (
select
v.matr,
v.lotacao,
v.total_vencimentos,
d.total_descontos,
round(v.total_vencimentos - coalesce(d.total_descontos, 0), 2) as salario
from (
    select
    emp.matr,
    emp.lotacao,
    coalesce(sum(venc.valor), 0) as total_vencimentos
    from empregado emp
    left join emp_venc ev on emp.matr = ev.matr
    left join vencimento venc on ev.cod_venc = venc.cod_venc
    group by emp.matr, emp.lotacao
) v
left join (
    select
    emp.matr,
    emp.lotacao,
    coalesce(sum(descs.valor), 0) as total_descontos
    from empregado emp
    left join emp_desc ed on emp.matr = ed.matr
    left join desconto descs on ed.cod_desc = descs.cod_desc
    group by emp.matr, emp.lotacao
) d
on v.matr = d.matr
) cs
join empregado e on cs.matr = e.matr
join departamento d on cs.lotacao = d.cod_dep
order by cs.salario desc;
